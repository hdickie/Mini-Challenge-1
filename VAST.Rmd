---
title: "VAST"
author: "Hume Dickie"
date: "May 22, 2017"
output: html_document
---

```{r setup}
library(magrittr)
library(ggplot2)

alreadyRun.timestamp <- FALSE
```


Results!
  1: GG7
  2: G8, G4, G3, GG6
  3: GG2
  4: G5
  5: G7
  6: G2
  7: GG1
  8: GG3, GG0, C6, GG5, C1, E4, E2, C8, G6
  9: G0
  10: G1
  11: GG4, E3, E0
  12: C3, C4, C0, C2, E1
  13: R4,C5
  14: R2
  15: R0
  16: R6
  17: R7
  18: R1
  19: R5, R3, C7, Base

```{r iGraphPageRank}
setwd("C:/Users/Hume Dickie/Desktop/Github/Mini-Challenge-1/data/")
network <- read.csv("matrix.csv")
network <- network[,-1]


for (i in 1:40) {
  for (j in i:40) {
    network[[i]][[j]] <- network[[j]][[i]]
  }
}


network.matrix <- as.matrix(network)

library(igraph)

g <- graph_from_adjacency_matrix(network.matrix,"undirected",diag = FALSE)

page_rank(g)
pagerank.results <- sort(page_rank(g)[[1]]) %>% rev()
plot(1:40,pagerank.results)
```

```{r sensorData}
setwd("C:/Users/Hume Dickie/Desktop/Github/Mini-Challenge-1/data")
sensor <- read.csv("sensor.csv")
#View(sensor)

timestamp.raw <- sensor[,1]
timestamp <- rep(list(),dim(sensor)[1])

#just to keep me from accidentally rerunning this bc it takes SO long
if (!alreadyRun.timestamp) {
  for (i in seq_along(timestamp.raw)) {
    if (i %% 10000 == 0) {
      print(i/dim(sensor)[1])
    }
    timestamp[[i]] <- as.POSIXlt(timestamp.raw[[i]])
  }
  alreadyRun.timestamp <- TRUE
  
  save(timestamp,"timestamp",file="timestamp-obj.RData")
}



```

(35460 entries with an entrance, divided by 2 =)
17,730 total visitors?

However, 18,708 unique car.ids!

But, the number of unique vehicles that have been to a ranger base is 998

17,730 + 998 = 18728. So if 20 unique non-ranger vehicles visited the range base, then all the numbers add up!
That would mean there are 978 rangers for a very small number of camping spots though...




From earlier code I didn't save, the park is definitely a summer location
```{r exploratoryAnaylsis}

activity.order <- sensor$gate.name %>% table() %>% sort() %>% names() %>% rev()
pagerank.order <- pagerank.results %>% sort() %>% names() %>% rev()

look.for.nonrandomness <- as.data.frame(cbind(pagerank.order,activity.order))
#not sure on the best way to use this. It's most meaningful at the ends but muddier in the middles
```

\\
Relative popularity of entrances (low to high): 3, 2, 4, 0, 1
                                      Expected: 2, 4, 0, 3, 1
                                      
3 is the only mismatch!
\\
Campsite popularity:
real: 8,5,4,6,3,2,7,0,1
xpctd:6,1,8,3,0,4,2,5,7

1 is a lot less popular, 5 is a lot more popular

\\


```{r checkOutSomePaths}
setwd("C:/Users/Hume Dickie/Desktop/Github/Mini-Challenge-1/data/")
labels = c("ID","enterTime")
for (i in 1:69) {
  labels <- c(labels,paste("N",i,sep=""),paste("dt",i,sep=""))
}
labels <- c(labels,"N70")
paths <- read.table("entries31max.txt",col.names = labels,fill = TRUE,sep=";")

#add path lengths
for (p in paths){
  for (i in 1:49) { #we know weird car is length 70 and everything else at most 49
    #TODO
  }
}
```



Just picking out the patterns I've seen

There is a weird car!!! It entered the park at 2015-06-05 14:57:59 and NEVER LEFT
```{r classificationByInspection}

weirdCar.path <- paths[16414,]
weirdCar.id <- "20155705025759-63"

weirdCar.sensor <- sensor[which(sensor$car.id == weirdCar.id),]
View(weirdCar.path)




#path length distro
path.distro <- list()
for (i in 1:49) {
  currLab <- paste("N",i,sep="")
  path.distro[[i]] <- dim(paths[which(paths[currLab] != ""),])[1]
}

#ranger path length distro
ranger.path.distro <- list()
paths.start.base <- paths[which(paths$N1 == "B"),]
for (i in 1:49) {
  currLab <- paste("N",i,sep="")
  ranger.path.distro[[i]] <- dim(paths.start.base[which(paths.start.base[currLab] != ""),])[1]
}

#all minus ranger distro (for comparison)
path.minus.ranger.distro <- list()
paths.minus.rangers <- paths[-which(paths$N1 == "B"),]
for (i in 1:49){
  currLab <- paste("N",i,sep="")
  path.minus.ranger.distro[[i]] <- dim(paths.minus.rangers[which(paths.minus.rangers[currLab] != ""),])[1]
}

```

All paths 28 or longer are rangers (except that 1 creepy car)
```{r takeaways}
#On average, rangers have much longer paths than the overall population of visitors
#Note that the y-axes are very different!
par(mfrow=c(2,1))
plot(1:27,path.minus.ranger.distro[1:27])
plot(1:27,ranger.path.distro[1:27])
```